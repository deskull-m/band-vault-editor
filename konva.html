<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vault Editor</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    canvas {
      display: block;
    }
    #editor {
        display:flex;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/konva/8.3.9/konva.min.js"></script>
</head>
<body>
    <div id="editor"></div>
    <div id="container"></div>

  <script>
    let mouseDown = false
    document.body.onmousedown = function() {
        mouseDown = true;
    }

    document.body.onmouseup = function() {
        mouseDown = false;
    }
    // グリッドサイズとマップサイズ
    const gridSize = 32; // タイルサイズ
    const mapWidth = 10; // 横タイル数
    const mapHeight = 10; // 縦タイル数

    const MapMaxSize = 300;
    let grid = Array.from({ length: MapMaxSize }, () => Array(MapMaxSize).fill(0));
    let currentTerrain = 1;

    // ステージを作成
    const stage = new Konva.Stage({
      container: 'container',
      width: gridSize * mapWidth,
      height: gridSize * mapHeight
    });

    // レイヤーを作成
    const layer = new Konva.Layer();
    stage.add(layer);

    // グリッドを描画する関数
    function drawGrid() {
      for (let i = 0; i < mapWidth; i++) {
        for (let j = 0; j < mapHeight; j++) {
          const rect = new Konva.Rect({
            x: i * gridSize,
            y: j * gridSize,
            width: gridSize,
            height: gridSize,
            fill: grid[i][j] === 0 ? "white" : "green",
            stroke: 'black',
            strokeWidth: 1
          });

          // クリックでタイルの色を変更する
          rect.on('mousemove', function() {
            if(mouseDown){
                grid[i][j] = currentTerrain;
                this.fill(grid[i][j] === 1 ? 'green' : 'white');
                layer.draw(); // レイヤーを再描画
            }
          });

          layer.add(rect);
        }
      }
    }

    // 初期化時にグリッドを描画
    drawGrid();

    // レイヤーをステージに追加
    layer.draw();
  </script>
</body>
</html>